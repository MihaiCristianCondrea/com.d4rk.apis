<div id="appToolkitPage" class="page-section active">
  <header class="page-header">
    <h1>App Toolkit API workspace</h1>
    <p>
      Configure the JSON payload that powers the App Toolkit catalog. The
      builder mirrors the production schema so you can manage listings for both
      debug and release channels with confidence.
    </p>
  </header>

  <section class="workspace-dashboard" aria-label="Workspace overview">
    <div class="workspace-insight-grid">
      <md-elevated-card class="insight-card">
        <div class="insight-card-header">
          <span class="material-symbols-outlined insight-icon">apps</span>
          <span class="insight-label">Apps in workspace</span>
        </div>
        <p class="insight-value" id="appToolkitTrackedCount">0</p>
        <p class="insight-helper">Live count mirrors the JSON preview.</p>
      </md-elevated-card>
      <md-elevated-card class="insight-card">
        <div class="insight-card-header">
          <span class="material-symbols-outlined insight-icon">rocket_launch</span>
          <span class="insight-label">Release ready</span>
        </div>
        <p class="insight-value" id="appToolkitReleaseReadyCount">0</p>
        <p class="insight-helper">Entries with rich media and required fields.</p>
      </md-elevated-card>
      <md-elevated-card class="insight-card">
        <div class="insight-card-header">
          <span class="material-symbols-outlined insight-icon">photo_library</span>
          <span class="insight-label">Screenshot average</span>
        </div>
        <p class="insight-value" id="appToolkitScreenshotAverage">0</p>
        <p class="insight-helper">Target three or more images per listing.</p>
      </md-elevated-card>
    </div>

    <div class="workspace-secondary-grid">
      <md-filled-card class="workspace-plan">
        <div class="card-body">
          <div class="plan-header">
            <h2>Today's pipeline</h2>
            <span class="plan-updated">Updated <span id="appToolkitLastEdited">awaiting changes</span></span>
          </div>
          <ol class="plan-list">
            <li>
              <span class="plan-step-title">Curate metadata</span>
              <span class="plan-step-meta" id="appToolkitReviewCount">0 entries queued</span>
            </li>
            <li>
              <span class="plan-step-title">Validate JSON preview</span>
              <span class="plan-step-meta">Keep status green before publishing.</span>
            </li>
            <li>
              <span class="plan-step-title">Publish to GitHub</span>
              <span class="plan-step-meta">Ship debug and release catalogs together.</span>
            </li>
          </ol>
          <div class="plan-actions">
            <md-filled-tonal-button id="appToolkitFocusButton">
              <md-icon slot="icon"
                ><span class="material-symbols-outlined">timelapse</span></md-icon
              >
              Start focus session
            </md-filled-tonal-button>
            <md-text-button id="appToolkitNotesButton">
              <md-icon slot="icon"
                ><span class="material-symbols-outlined">edit_note</span></md-icon
              >
              Capture notes
              <span class="note-indicator" aria-hidden="true">●</span>
            </md-text-button>
          </div>
        </div>
      </md-filled-card>

      <md-filled-card class="workspace-release">
        <div class="card-body">
          <div class="release-header">
            <h2>Release readiness</h2>
            <p id="appToolkitWorkspacePulse">Review entries to unlock insights.</p>
          </div>
          <div class="release-progress" role="img" aria-label="Release readiness progress">
            <div class="release-progress-track">
              <div class="release-progress-bar" id="appToolkitReleaseProgress"></div>
            </div>
            <div class="release-progress-legend">
              <span>Debug</span>
              <span>Release</span>
            </div>
          </div>
          <ul class="release-tips">
            <li>Add icons and three screenshots to unlock release readiness.</li>
            <li>Use quick presets below to pull the latest production data.</li>
          </ul>
        </div>
      </md-filled-card>
    </div>
  </section>

  <md-filled-card class="guidance-card">
    <div class="card-body">
      <h2>Before you start</h2>
      <ul>
        <li>
          Each app entry must include <strong>name</strong>,
          <strong>packageName</strong>, <strong>category</strong>, and an
          <strong>iconLogo</strong> URL.
        </li>
        <li>
          Screenshots appear in the same order they are added. Provide at least
          three URLs for release builds.
        </li>
        <li>
          When you are done, export the JSON and replace the existing file in
          <code>App Toolkit/[debug|release]/en/home/api_android_apps.json</code>.
        </li>
        <li>
          Use <strong>Fetch existing JSON</strong> to pull the latest data from a
          remote file before editing.
        </li>
      </ul>
    </div>
  </md-filled-card>

  <section
    class="api-builder"
    id="appToolkitBuilder"
    data-builder-type="app-toolkit"
  >
    <div class="builder-toolbar">
      <div class="builder-toolbar-actions">
        <md-filled-button id="appToolkitAddApp">
          <md-icon slot="icon"
            ><span class="material-symbols-outlined">add</span></md-icon
          >
          Add app
        </md-filled-button>
        <md-outlined-button id="appToolkitImportButton">
          <md-icon slot="icon"
            ><span class="material-symbols-outlined">upload</span></md-icon
          >
          Import JSON
        </md-outlined-button>
        <input
          type="file"
          id="appToolkitImportInput"
          accept="application/json"
          hidden
        />
        <md-text-button id="appToolkitResetButton">
          <md-icon slot="icon"
            ><span class="material-symbols-outlined">refresh</span></md-icon
          >
          Clear workspace
        </md-text-button>
      </div>
      <div class="builder-toolbar-meta">
        <div class="toolbar-status" role="status" aria-live="polite">
          <span class="toolbar-status-label">Workspace pulse</span>
          <span class="toolbar-status-value" id="appToolkitToolbarPulse">Awaiting input</span>
        </div>
        <div class="toolbar-filters" aria-label="Workspace filters">
          <span class="toolbar-label">Focus filters</span>
          <md-filter-chip-set id="appToolkitFilterChips" aria-label="Filter apps needing attention">
            <md-filter-chip value="pending-release" data-app-toolkit-filter="pendingReleaseReady">
              Pending release-ready
            </md-filter-chip>
            <md-filter-chip value="needs-screenshots" data-app-toolkit-filter="needsScreenshots">
              Needs screenshots
            </md-filter-chip>
          </md-filter-chip-set>
        </div>
        <div class="toolbar-segment" aria-label="Channel focus">
          <span class="toolbar-label">Channel focus</span>
          <md-segmented-button-set id="appToolkitChannelSegments" aria-label="Channel focus">
            <md-segmented-button value="both" data-app-toolkit-channel="both" selected>
              Dual
            </md-segmented-button>
            <md-segmented-button value="debug" data-app-toolkit-channel="debug">
              Debug
            </md-segmented-button>
            <md-segmented-button value="release" data-app-toolkit-channel="release">
              Release
            </md-segmented-button>
          </md-segmented-button-set>
        </div>
        <div class="toolbar-segment" aria-label="Layout density">
          <span class="toolbar-label">Layout</span>
          <md-segmented-button-set id="appToolkitLayoutSegments" aria-label="Layout density">
            <md-segmented-button value="flow" data-app-toolkit-mode="flow" selected>
              Flow
            </md-segmented-button>
            <md-segmented-button value="compact" data-app-toolkit-mode="compact">
              Compact
            </md-segmented-button>
          </md-segmented-button-set>
        </div>
      </div>
    </div>

    <md-filled-card class="builder-remote-card" id="appToolkitRemoteImport">
      <div class="card-body">
        <div class="builder-remote-header">
          <div>
            <h2>Fetch existing JSON</h2>
            <p>Pull the latest payload before you start editing entries.</p>
          </div>
        </div>
        <div class="builder-remote-controls">
          <md-outlined-text-field
            id="appToolkitFetchInput"
            type="url"
            label="JSON URL"
            placeholder="https://example.com/api_android_apps.json"
            supporting-text="Paste a direct link to the current api_android_apps.json file"
            spellcheck="false"
          >
            <md-icon slot="leading-icon"
              ><span class="material-symbols-outlined">link</span></md-icon
            >
          </md-outlined-text-field>
          <md-filled-tonal-button id="appToolkitFetchButton">
            <md-icon slot="icon"
              ><span class="material-symbols-outlined">cloud_download</span></md-icon
            >
            Fetch from URL
          </md-filled-tonal-button>
        </div>
        <div class="builder-remote-presets" aria-label="Quick fetch shortcuts">
          <span class="builder-remote-presets-label">Quick links</span>
          <md-text-button
            data-app-toolkit-preset="https://raw.githubusercontent.com/MihaiCristianCondrea/com.d4rk.apis/refs/heads/main/App%20Toolkit/debug/en/home/api_android_apps.json"
            id="appToolkitDebugPreset"
          >
            <md-icon slot="icon"
              ><span class="material-symbols-outlined">download</span></md-icon
            >
            Debug · EN
          </md-text-button>
          <md-text-button
            data-app-toolkit-preset="https://raw.githubusercontent.com/MihaiCristianCondrea/com.d4rk.apis/refs/heads/main/App%20Toolkit/release/en/home/api_android_apps.json"
            id="appToolkitReleasePreset"
          >
            <md-icon slot="icon"
              ><span class="material-symbols-outlined">download</span></md-icon
            >
            Release · EN
          </md-text-button>
        </div>
      </div>
    </md-filled-card>

    <md-filled-card class="builder-remote-card" id="appToolkitGithubCard">
      <div class="card-body">
        <div class="builder-remote-header">
          <div>
            <h2>Publish to GitHub</h2>
            <p>
              Use the GitHub Contents API to update the catalog once the JSON
              preview is valid. Tokens are used only for this request and never
              stored.
            </p>
          </div>
        </div>
        <div class="builder-github-note" role="note">
          <p>
            <strong>Create a personal access token</strong> from
            <em>GitHub → Settings → Developer settings → Personal access tokens</em>.
            Choose a fine-grained token when possible and limit it to the
            repository you are publishing.
          </p>
          <ul>
            <li>
              Fine-grained tokens: enable
              <strong>Repository permissions → Contents: Read &amp; write</strong>
              (Metadata is added automatically).
            </li>
            <li>
              Classic tokens: select only
              <code>public_repo</code> for public catalogs or
              <code>repo</code> for private catalogs.
            </li>
            <li>Copy the token once and keep it outside of source control.</li>
          </ul>
        </div>
        <div class="builder-github-launch">
          <md-filled-button id="appToolkitGithubWizardButton">
            <md-icon slot="icon"
              ><span class="material-symbols-outlined">rocket_launch</span></md-icon
            >
            Open publish wizard
          </md-filled-button>
          <p class="builder-github-helper">
            Validate the preview first, then follow the guided steps to publish.
          </p>
        </div>
      </div>
    </md-filled-card>

    <div class="builder-layout builder-columns">
      <div class="builder-forms" id="appToolkitEntries" aria-live="polite"></div>
      <aside class="builder-preview" aria-label="JSON preview">
        <div class="preview-header">
          <h2>Preview &amp; export</h2>
          <p>Changes update automatically as you edit entries.</p>
        </div>
        <textarea
          id="appToolkitPreview"
          class="preview-textarea"
          readonly
          spellcheck="false"
          aria-label="App Toolkit JSON preview"
        ></textarea>
        <div
          class="preview-validation"
          id="appToolkitValidation"
          role="status"
          aria-live="polite"
        ></div>
        <div class="preview-actions">
          <md-filled-tonal-button id="appToolkitCopyButton">
            <md-icon slot="icon"
              ><span class="material-symbols-outlined">content_copy</span></md-icon
            >
            Copy JSON
          </md-filled-tonal-button>
          <md-outlined-button id="appToolkitDownloadButton" trailing-icon>
            Download
            <md-icon slot="icon"
              ><span class="material-symbols-outlined">download</span></md-icon
            >
          </md-outlined-button>
        </div>
      </aside>
      <md-side-sheet
        id="appToolkitDiffSheet"
        class="builder-diff-sheet"
        aria-label="Workspace diff"
      >
        <div slot="headline">Workspace diff</div>
        <div slot="supporting-text">
          Compare the current workspace against the last exported payload.
        </div>
        <div slot="content" class="diff-sheet-content">
          <pre id="appToolkitDiffContent" aria-live="polite"></pre>
        </div>
      </md-side-sheet>
    </div>
  </section>

  <md-dialog id="appToolkitScreenshotDialog" class="screenshot-dialog">
    <div slot="headline" id="appToolkitScreenshotDialogHeadline">Screenshot preview</div>
    <div slot="content" class="screenshot-dialog-content">
      <img id="appToolkitScreenshotDialogImage" alt="Selected screenshot preview" />
      <p id="appToolkitScreenshotDialogCaption" class="screenshot-dialog-caption"></p>
    </div>
    <div slot="actions">
      <md-text-button dialog-action="close">Close</md-text-button>
      <md-text-button id="appToolkitScreenshotDialogOpen" target="_blank">
        Open in new tab
      </md-text-button>
    </div>
  </md-dialog>

  <md-dialog id="appToolkitFocusDialog" class="focus-dialog">
    <div slot="headline">Focus session</div>
    <div slot="content" class="focus-dialog-content">
      <div class="focus-dialog-timer" id="appToolkitFocusTimer" aria-live="polite">25:00</div>
      <div class="focus-dialog-controls">
        <md-filled-tonal-button id="appToolkitFocusStart">Start</md-filled-tonal-button>
        <md-filled-tonal-button id="appToolkitFocusPause">Pause</md-filled-tonal-button>
        <md-text-button id="appToolkitFocusReset">Reset</md-text-button>
      </div>
      <div class="focus-dialog-checklist">
        <h3>Pending checklist</h3>
        <md-list id="appToolkitFocusChecklist" class="focus-checklist"></md-list>
      </div>
      <md-filled-text-field
        id="appToolkitFocusNotes"
        label="Session notes"
        supporting-text="Notes are saved locally for this browser session."
        rows="4"
        multiline
      ></md-filled-text-field>
    </div>
    <div slot="actions">
      <md-text-button dialog-action="close">Close</md-text-button>
      <md-filled-button id="appToolkitFocusSave">Save note</md-filled-button>
    </div>
  </md-dialog>

  <md-dialog id="appToolkitGithubDialog" class="github-dialog">
    <div slot="headline">Publish to GitHub</div>
    <div slot="content" class="github-dialog-content">
      <md-steppers id="appToolkitGithubStepper" value="authenticate">
        <md-step value="authenticate" label="Authenticate">
          <div class="github-step" data-step="authenticate">
            <md-filled-text-field
              id="appToolkitGithubToken"
              label="Personal access token"
              type="password"
              autocomplete="off"
              spellcheck="false"
              supporting-text="Tokens require Contents: Read &amp; write access."
            ></md-filled-text-field>
            <div class="github-step-actions">
              <input
                type="file"
                id="appToolkitGithubTokenFile"
                accept="text/plain,.txt,.token"
                hidden
              />
              <md-outlined-button id="appToolkitGithubTokenFileButton">
                <md-icon slot="icon"
                  ><span class="material-symbols-outlined">description</span></md-icon
                >
                Load token from file
              </md-outlined-button>
            </div>
          </div>
        </md-step>
        <md-step value="target" label="Target">
          <div class="github-step" data-step="target">
            <md-filled-text-field
              id="appToolkitGithubRepo"
              label="Repository (owner/name)"
              value="MihaiCristianCondrea/com.d4rk.apis"
              supporting-text="Use owner/name format."
              spellcheck="false"
            ></md-filled-text-field>
            <md-filled-text-field
              id="appToolkitGithubBranch"
              label="Branch"
              value="main"
              spellcheck="false"
            ></md-filled-text-field>
            <md-filled-text-field
              id="appToolkitGithubMessage"
              label="Commit message"
              value="chore(app-toolkit): update catalog"
              spellcheck="false"
            ></md-filled-text-field>
            <md-outlined-select
              id="appToolkitGithubChannel"
              label="Target channel"
              value="debug"
            >
              <md-select-option value="debug">Debug</md-select-option>
              <md-select-option value="release">Release</md-select-option>
              <md-select-option value="both">Debug &amp; Release</md-select-option>
            </md-outlined-select>
          </div>
        </md-step>
        <md-step value="review" label="Review">
          <div class="github-step" data-step="review">
            <p class="github-review-copy">
              Confirm the diff in the side sheet and publish when ready.
            </p>
            <div class="github-status" id="appToolkitGithubStatus" role="status" aria-live="polite"></div>
          </div>
        </md-step>
      </md-steppers>
    </div>
    <div slot="actions" class="github-dialog-actions">
      <md-text-button dialog-action="close">Cancel</md-text-button>
      <md-text-button id="appToolkitGithubBack">Back</md-text-button>
      <md-filled-button id="appToolkitGithubNext">Next</md-filled-button>
    </div>
  </md-dialog>
</div>
