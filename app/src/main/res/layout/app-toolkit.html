<div id="appToolkitPage" class="page-section app-shell-panel active">
  <header class="page-header">
    <h1>App Toolkit API workspace</h1>
    <p>Configure the JSON payload that powers the App Toolkit catalog. The builder mirrors the production schema so you can manage listings for both debug and release channels with confidence.</p>
  </header>
  <section class="workspace-dashboard" aria-label="Workspace overview">
    <div class="workspace-insight-grid">
      <div class="insight-card-header">
        <span class="material-symbols-outlined insight-icon">apps</span> <span class="insight-label">Apps in workspace</span>
      </div>
      <p class="insight-value" id="appToolkitTrackedCount">0</p>
      <p class="insight-helper">Live count mirrors the JSON preview.</p>
      <div class="insight-card-header">
        <span class="material-symbols-outlined insight-icon">rocket_launch</span> <span class="insight-label">Release ready</span>
      </div>
      <p class="insight-value" id="appToolkitReleaseReadyCount">0</p>
      <p class="insight-helper">Entries with rich media and required fields.</p>
      <div class="insight-card-header">
        <span class="material-symbols-outlined insight-icon">photo_library</span> <span class="insight-label">Screenshot average</span>
      </div>
      <p class="insight-value" id="appToolkitScreenshotAverage">0</p>
      <p class="insight-helper">Target three or more images per listing.</p>
    </div>
    <div class="workspace-secondary-grid">
      <div class="card-body">
        <div class="plan-header">
          <h2>Today's pipeline</h2><span class="plan-updated">Updated <span id="appToolkitLastEdited">awaiting changes</span></span>
        </div>
        <ol class="plan-list">
          <li><span class="plan-step-title">Curate metadata</span> <span class="plan-step-meta" id="appToolkitReviewCount">0 entries queued</span></li>
          <li><span class="plan-step-title">Validate JSON preview</span> <span class="plan-step-meta">Keep status green before publishing.</span></li>
          <li><span class="plan-step-title">Publish to GitHub</span> <span class="plan-step-meta">Ship debug and release catalogs together.</span></li>
        </ol>
      </div>
      <div class="card-body">
        <div class="release-header">
          <h2>Release readiness</h2>
          <p id="appToolkitWorkspacePulse">Review entries to unlock insights.</p>
        </div>
        <div class="release-progress" role="img" aria-label="Release readiness progress">
          <div class="release-progress-track">
            <div class="release-progress-bar" id="appToolkitReleaseProgress"></div>
          </div>
          <div class="release-progress-legend">
            <span>Debug</span> <span>Release</span>
          </div>
        </div>
        <ul class="release-tips">
          <li>Add icons and three screenshots to unlock release readiness.</li>
          <li>Use quick presets below to pull the latest production data.</li>
        </ul>
      </div>
    </div>
  </section>
  <div class="card-body">
    <h2>Before you start</h2>
    <ul>
      <li>Each app entry must include <strong>name</strong>, <strong>packageName</strong>, a <strong>category</strong> with <code>label</code> and <code>category_id</code>, and an <strong>iconLogo</strong> URL.</li>
      <li>Screenshots appear in the same order they are added. Provide at least three URLs for release builds.</li>
      <li>When you are done, export the JSON and replace the existing file in <code>api/app_toolkit/v2/[debug|release]/en/home/api_android_apps.json</code> to mirror the production structure.</li>
      <li>Use <strong>Fetch existing JSON</strong> to pull the latest data from a remote file before editing.</li>
    </ul>
  </div>
  <section class="api-builder" id="appToolkitBuilder" data-builder-type="app-toolkit">
    <div class="builder-toolbar">
      <div class="builder-toolbar-actions">
        <span class="material-symbols-outlined">add</span> Add app <span class="material-symbols-outlined">sort</span> <span class="builder-sort-label">Sort · <span id="appToolkitSortLabel">App name (A–Z)</span></span> <span class="material-symbols-outlined">arrow_drop_down</span>
        <div slot="headline">
          App name (A–Z)
        </div>
        <div slot="headline">
          Category (A–Z)
        </div>
        <div slot="headline">
          Screenshot count (high to low)
        </div><span class="material-symbols-outlined">refresh</span> Clear workspace
      </div>
      <div class="builder-toolbar-meta">
        <div class="toolbar-status" role="status" aria-live="polite">
          <span class="toolbar-status-label">Workspace pulse</span> <span class="toolbar-status-value" id="appToolkitToolbarPulse">Awaiting input</span>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="builder-remote-header">
        <div>
          <h2>Fetch existing JSON</h2>
          <p>Pull the latest payload before you start editing entries.</p>
        </div>
      </div>
      <div class="builder-remote-controls">
        <div class="builder-remote-inline-action" id="appToolkitFetchFieldset">
          <span class="material-symbols-outlined">link</span> <span class="material-symbols-outlined">cloud_download</span> Load JSON
        </div>
        <p class="builder-remote-feedback" id="appToolkitFetchStatus" data-status="idle" role="status" aria-live="polite"><span class="material-symbols-outlined builder-remote-feedback-icon" aria-hidden="true">info</span> <span class="builder-remote-feedback-text">Paste a JSON URL to load the latest data.</span></p>
      </div>
      <div class="builder-remote-presets" aria-label="Quick fetch shortcuts">
        <span class="builder-remote-presets-label">Quick links</span> <span class="material-symbols-outlined">download</span> Debug · EN <span class="material-symbols-outlined">download</span> Release · EN
      </div>
    </div>
    <div class="card-body">
      <div class="builder-remote-header">
        <div>
          <h2>Publish to GitHub</h2>
          <p>Use the GitHub Contents API to update the catalog once the JSON preview is valid. Tokens are used only for this request and never stored.</p>
        </div>
      </div>
      <div class="builder-github-note" role="note">
        <p><strong>Create a personal access token</strong> from <em>GitHub → Settings → Developer settings → Personal access tokens</em>. Choose a fine-grained token when possible and limit it to the repository you are publishing.</p>
        <ul>
          <li>Fine-grained tokens: enable <strong>Repository permissions → Contents: Read & write</strong> (Metadata is added automatically).</li>
          <li>Classic tokens: select only <code>public_repo</code> for public catalogs or <code>repo</code> for private catalogs.</li>
          <li>Copy the token once and keep it outside of source control.</li>
        </ul>
      </div>
      <div class="builder-github-launch">
        <span class="material-symbols-outlined">rocket_launch</span> Open publish wizard
        <p class="builder-github-helper">Validate the preview first, then follow the guided steps to publish.</p>
      </div>
    </div>
    <div class="builder-layout builder-columns">
      <div class="builder-forms" id="appToolkitEntries" aria-live="polite"></div>
      <aside class="builder-preview" aria-label="JSON preview">
        <div class="preview-header">
          <h2>Preview & export</h2>
          <p>Changes update automatically as you edit entries.</p>
        </div>
        <textarea id="appToolkitPreview" class="preview-textarea" readonly spellcheck="false" aria-label="App Toolkit JSON preview"></textarea>
        <div class="preview-validation" id="appToolkitValidation" role="status" aria-live="polite"></div>
        <div class="preview-actions">
          <span class="material-symbols-outlined">content_copy</span> Copy JSON Download <span class="material-symbols-outlined">download</span>
        </div>
      </aside>
      <div slot="headline">
        Workspace diff
      </div>
      <div slot="supporting-text">
        Compare the current workspace against the last exported payload.
      </div>
      <div slot="content" class="diff-sheet-content">
        <div id="appToolkitDiffContent" class="diff-view diff-view--empty" role="status" aria-live="polite"></div>
      </div>
    </div>
  </section>
  <div slot="headline">
    Publish to GitHub
  </div>
  <div slot="content" class="github-dialog-content">
    <div class="github-step" data-step="authenticate">
      <div class="github-step-actions">
        <input type="file" id="appToolkitGithubTokenFile" accept="text/plain,.txt,.token" hidden=""> <span class="material-symbols-outlined">description</span> Load token from file
      </div>
    </div>
    <div class="github-step" data-step="target">
      Debug Release Debug & Release
    </div>
    <div class="github-step" data-step="review">
      <p class="github-review-copy">Confirm the diff in the side sheet and publish when ready.</p>
      <div class="github-status" id="appToolkitGithubStatus" role="status" aria-live="polite"></div>
    </div>
  </div>
  <div slot="actions" class="github-dialog-actions">
    Cancel Back Next
  </div>
</div>